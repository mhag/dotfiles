autoload -U compinit; compinit
export PATH=$PATH:/usr/sbin:~/bin:/usr/local/bin
export HOSTNAME=hostname

alias su='sudo su -s /bin/zsh'

HISTSIZE=5000
PROMPT='%{^39m%}%U$USER%{@^33m%}%m%{::^32m%}%~%%^m%}%u'

autoload -Uz vcs_info
zstyle ':vcs_info:*' formats '(%s)-[%b]'
zstyle ':vcs_info:*' actionformats '(%s)-[%b|%a]'
precmd () {
    psvar=()
    LANG=en_US.UTF-8 vcs_info
    [[ -n "$vcs_info_msg_0_" ]] && psvar[1]="$vcs_info_msg_0_"
}
RPROMPT="%1(v|%F{green}%1v%f|)"

zstyle ':completion:*:sudo:*' command-path /usr/local/sbin /usr/local/bin \
                             /usr/sbin /usr/bin /sbin /bin /usr/X11R6/bin

## è£œå®Œæ™‚ã«å¤§å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Z}'
zstyle ':completion:*' menu select=1

#=============================================================#
if [ -f /sw/bin/init.sh ]; then
  source /sw/bin/init.sh
fi

#=============================================================#
# å±¥æ­´
HISTFILE=~/.zsh-history
HISTSIZE=1000000
SAVEHIST=1000000

# è¤‡æ•°ã® zsh ã‚’åŒæ™‚ã«ä½¿ã†æ™‚ãªã© history ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¸Šæ›¸ãã›ãšè¿½åŠ ã™ã‚‹
setopt append_history

# zsh ã®é–‹å§‹ãƒ»çµ‚äº†æ™‚åˆ»ã‚’ãƒ’ã‚¹ãƒˆãƒªãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€
setopt extended_history

# ç›´å‰ã¨åŒã˜ã‚³ãƒžãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã¯ãƒ’ã‚¹ãƒˆãƒªã«è¿½åŠ ã—ãªã„
setopt hist_ignore_all_dups

# ã‚³ãƒžãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã®å…ˆé ­ãŒã‚¹ãƒšãƒ¼ã‚¹ã§å§‹ã¾ã‚‹å ´åˆãƒ’ã‚¹ãƒˆãƒªã«è¿½åŠ ã—ãªã„
setopt hist_ignore_space

# ã‚·ã‚§ãƒ«ã®ãƒ—ãƒ­ã‚»ã‚¹ã”ã¨ã«å±¥æ­´ã‚’å…±æœ‰
setopt share_history

# history (fc -l) ã‚³ãƒžãƒ³ãƒ‰ã‚’ãƒ’ã‚¹ãƒˆãƒªãƒªã‚¹ãƒˆã‹ã‚‰å–ã‚Šé™¤ãã€‚
setopt hist_no_store

# ãƒ’ã‚¹ãƒˆãƒªã‚’å‘¼ã³å‡ºã—ã¦ã‹ã‚‰å®Ÿè¡Œã™ã‚‹é–“ã«ä¸€æ—¦ç·¨é›†ã§ãã‚‹çŠ¶æ…‹ã«ãªã‚‹
setopt hist_verify

#=============================================================#


# æŒ‡å®šã—ãŸã‚³ãƒžãƒ³ãƒ‰åãŒãªãã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã¨ä¸€è‡´ã—ãŸå ´åˆ cd ã™ã‚‹
#setopt auto_cd

# è£œå®Œå€™è£œãŒè¤‡æ•°ã‚ã‚‹æ™‚ã«ã€ä¸€è¦§è¡¨ç¤ºã™ã‚‹
setopt auto_list

# zsh: no matches found å¯¾ç­–
setopt nonomatch

# è£œå®Œã‚­ãƒ¼ï¼ˆTab, Ctrl+I) ã‚’é€£æ‰“ã™ã‚‹ã ã‘ã§é †ã«è£œå®Œå€™è£œã‚’è‡ªå‹•ã§è£œå®Œã™ã‚‹
#setopt auto_menu

# ã‚«ãƒƒã‚³ã®å¯¾å¿œãªã©ã‚’è‡ªå‹•çš„ã«è£œå®Œã™ã‚‹
setopt auto_param_keys

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã®è£œå®Œã§æœ«å°¾ã® / ã‚’è‡ªå‹•çš„ã«ä»˜åŠ ã—ã€æ¬¡ã®è£œå®Œã«å‚™ãˆã‚‹
setopt auto_param_slash

# æœ€å¾ŒãŒãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã§çµ‚ã‚ã£ã¦ã„ã‚‹å ´åˆæœ«å°¾ã® / ã‚’è‡ªå‹•çš„ã«å–ã‚Šé™¤ã
#setopt auto_remove_slash

# ã‚µã‚¹ãƒšãƒ³ãƒ‰ä¸­ã®ãƒ—ãƒ­ã‚»ã‚¹ã¨åŒã˜ã‚³ãƒžãƒ³ãƒ‰åã‚’å®Ÿè¡Œã—ãŸå ´åˆã¯ãƒªã‚¸ãƒ¥ãƒ¼ãƒ ã™ã‚‹
setopt auto_resume

# ãƒ“ãƒ¼ãƒ—éŸ³ã‚’é³´ã‚‰ã•ãªã„ã‚ˆã†ã«ã™ã‚‹
setopt NO_beep

# {a-c} ã‚’ a b c ã«å±•é–‹ã™ã‚‹æ©Ÿèƒ½ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
setopt brace_ccl

# å†…éƒ¨ã‚³ãƒžãƒ³ãƒ‰ã® echo ã‚’ BSD äº’æ›ã«ã™ã‚‹
#setopt bsd_echo

# ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã¯å®Ÿä½“ã‚’è¿½ã†ã‚ˆã†ã«ãªã‚‹
#setopt chase_links

# æ—¢å­˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãã—ãªã„ã‚ˆã†ã«ã™ã‚‹
#setopt clobber

# ã‚³ãƒžãƒ³ãƒ‰ã®ã‚¹ãƒšãƒ«ãƒã‚§ãƒƒã‚¯ã‚’ã™ã‚‹
#setopt correct

# ã‚³ãƒžãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å…¨ã¦ã®ã‚¹ãƒšãƒ«ãƒã‚§ãƒƒã‚¯ã‚’ã™ã‚‹
#setopt correct_all

# =command ã‚’ command ã®ãƒ‘ã‚¹åã«å±•é–‹ã™ã‚‹
setopt equals

# ãƒ•ã‚¡ã‚¤ãƒ«åã§ #, ~, ^ ã® 3 æ–‡å­—ã‚’æ­£è¦è¡¨ç¾ã¨ã—ã¦æ‰±ã†
#setopt extended_glob

# Ctrl+S/Ctrl+Q ã«ã‚ˆã‚‹ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ã‚’ä½¿ã‚ãªã„ã‚ˆã†ã«ã™ã‚‹
setopt NO_flow_control

# å„ã‚³ãƒžãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ãã«ãƒ‘ã‚¹ã‚’ãƒãƒƒã‚·ãƒ¥ã«å…¥ã‚Œã‚‹
#setopt hash_cmds

# ã‚·ã‚§ãƒ«ãŒçµ‚äº†ã—ã¦ã‚‚è£ã‚¸ãƒ§ãƒ–ã« HUP ã‚·ã‚°ãƒŠãƒ«ã‚’é€ã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹
setopt NO_hup

# Ctrl+D ã§ã¯çµ‚äº†ã—ãªã„ã‚ˆã†ã«ãªã‚‹ï¼ˆexit, logout ãªã©ã‚’ä½¿ã†ï¼‰
setopt ignore_eof

# ã‚³ãƒžãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ã‚‚ # ä»¥é™ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã¨è¦‹ãªã™
setopt interactive_comments

# auto_list ã®è£œå®Œå€™è£œä¸€è¦§ã§ã€ls -F ã®ã‚ˆã†ã«ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®åˆ¥ã‚’ãƒžãƒ¼ã‚¯è¡¨ç¤º
setopt list_types

# å†…éƒ¨ã‚³ãƒžãƒ³ãƒ‰ jobs ã®å‡ºåŠ›ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ jobs -l ã«ã™ã‚‹
setopt long_list_jobs

# ã‚³ãƒžãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã®å¼•æ•°ã§ --prefix=/usr ãªã©ã® = ä»¥é™ã§ã‚‚è£œå®Œã§ãã‚‹
setopt magic_equal_subst

# ãƒ¡ãƒ¼ãƒ«ã‚¹ãƒ—ãƒ¼ãƒ« $MAIL ãŒèª­ã¾ã‚Œã¦ã„ãŸã‚‰ãƒ¯ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’è¡¨ç¤ºã™ã‚‹
#setopt mail_warning

# ãƒ•ã‚¡ã‚¤ãƒ«åã®å±•é–‹ã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒžãƒƒãƒã—ãŸå ´åˆæœ«å°¾ã« / ã‚’ä»˜åŠ ã™ã‚‹
setopt mark_dirs

# è£œå®Œå€™è£œãŒè¤‡æ•°ã‚ã‚‹æ™‚ã€ä¸€è¦§è¡¨ç¤º (auto_list) ã›ãšã€ã™ãã«æœ€åˆã®å€™è£œã‚’è£œå®Œã™ã‚‹
#setopt menu_complete

# è¤‡æ•°ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚„ãƒ‘ã‚¤ãƒ—ãªã©ã€å¿…è¦ã«å¿œã˜ã¦ tee ã‚„ cat ã®æ©Ÿèƒ½ãŒä½¿ã‚ã‚Œã‚‹
setopt multios

# ãƒ•ã‚¡ã‚¤ãƒ«åã®å±•é–‹ã§ã€è¾žæ›¸é †ã§ã¯ãªãæ•°å€¤çš„ã«ã‚½ãƒ¼ãƒˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹
#setopt numeric_glob_sort

# ã‚³ãƒžãƒ³ãƒ‰åã« / ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã¨ã PATH ä¸­ã®ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŽ¢ã™
#setopt path_dirs

# 8 ãƒ“ãƒƒãƒˆç›®ã‚’é€šã™ã‚ˆã†ã«ãªã‚Šã€æ—¥æœ¬èªžã®ãƒ•ã‚¡ã‚¤ãƒ«åãªã©ã‚’è¦‹ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹
setopt print_eightbit

# æˆ»ã‚Šå€¤ãŒ 0 ä»¥å¤–ã®å ´åˆçµ‚äº†ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã™ã‚‹
#setopt print_exit_value

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¹ã‚¿ãƒƒã‚¯ã«åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¿½åŠ ã—ãªã„ã‚ˆã†ã«ãªã‚‹
#setopt pushd_ignore_dups

# pushd ã‚’å¼•æ•°ãªã—ã§å®Ÿè¡Œã—ãŸå ´åˆ pushd $HOME ã¨è¦‹ãªã•ã‚Œã‚‹
#setopt pushd_to_home

# rm * ãªã©ã®éš›ã€æœ¬å½“ã«å…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¶ˆã—ã¦è‰¯ã„ã‹ã®ç¢ºèªã—ãªã„ã‚ˆã†ã«ãªã‚‹
#setopt rm_star_silent

# rm_star_silent ã®é€†ã§ã€10 ç§’é–“åå¿œã—ãªããªã‚Šã€é ­ã‚’å†·ã¾ã™æ™‚é–“ãŒä¸Žãˆã‚‰ã‚Œã‚‹
#setopt rm_star_wait

# for, repeat, select, if, function ãªã©ã§ç°¡ç•¥æ–‡æ³•ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹
setopt short_loops

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¤‡æ•°è¡Œã‚³ãƒžãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ç·¨é›†ã§ã¯ãªãã€ï¼‘è¡Œç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã«ãªã‚‹
#setopt single_line_zle

# ã‚³ãƒžãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãŒã©ã®ã‚ˆã†ã«å±•é–‹ã•ã‚Œå®Ÿè¡Œã•ã‚ŒãŸã‹ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ãªã‚‹
#setopt xtrace

#
# set prompt
#
case ${UID} in
0)
    PROMPT="%B%{[31m%}%/#%{[m%}%b "
    PROMPT2="%B%{[31m%}%_#%{[m%}%b "
    SPROMPT="%B%{[31m%}%r is correct? [n,y,a,e]:%{[m%}%b "
    [ -n "${REMOTEHOST}${SSH_CONNECTION}" ] && 
        PROMPT="%{[37m%}${HOST%%.*} ${PROMPT}"
    ;;
*)
    PROMPT="%{[31m%}%/%%%{[m%} "
    PROMPT2="%{[31m%}%_%%%{[m%} "
    SPROMPT="%{[31m%}%r is correct? [n,y,a,e]:%{[m%} "
    [ -n "${REMOTEHOST}${SSH_CONNECTION}" ] && 
        PROMPT="%{[37m%}${HOST%%.*} ${PROMPT}"
    ;;
esac

# set terminal title including current directory
#
case "${TERM}" in
kterm*|xterm)
    precmd() {
        echo -ne "\033]0;${USER}@${HOST%%.*}:${PWD}\007"
    }
    ;;
esac

# è‰²ã‚’ä½¿ã†
setopt prompt_subst

# æ–‡å­—åˆ—æœ«å°¾ã«æ”¹è¡Œã‚³ãƒ¼ãƒ‰ãŒç„¡ã„å ´åˆã§ã‚‚è¡¨ç¤ºã™ã‚‹
unsetopt promptcr

#ã‚³ãƒ”ãƒšã®æ™‚rpromptã‚’éžè¡¨ç¤ºã™ã‚‹
setopt transient_rprompt

# cd -[tab] ã§pushd
#setopt autopushd

# keychainã®è¨­å®š
# keychain ~/.ssh/id_rsa
# . ~/.keychain/$HOSTNAME-sh

# ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ä¸Šã‹ã‚‰è£œå®Œã™ã‚‹ã€‚Ctrl + o
HARDCOPYFILE=$HOME/tmp/screen-hardcopy
touch $HARDCOPYFILE

dabbrev-complete () {
        local reply lines=80 # 80è¡Œåˆ†
        screen -X eval "hardcopy -h $HARDCOPYFILE"
        reply=($(sed '/^$/d' $HARDCOPYFILE | sed '$ d' | tail -$lines))
        compadd - "${reply[@]%[*/=@|]}"
}

zle -C dabbrev-complete menu-complete dabbrev-complete
bindkey '^o' dabbrev-complete
bindkey '^o^_' reverse-menu-complete


# SSHã‚³ãƒžãƒ³ãƒ‰ã¯screenã®æ–°ã—ã„çª“ã§
function ssh_screen(){
 eval server=\${$#}
 screen -t $server ssh "$@"
}
if [ x$TERM = xscreen ]; then
  alias ssh=ssh_screen
fi

# æœ€å¾Œã«æ‰“ã£ãŸã‚³ãƒžãƒ³ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡Œã«
if [ "$TERM" = "screen" ]; then
        chpwd () { echo -n "_`dirs`\\" }
        preexec() {
                # see [zsh-workers:13180]
                # http://www.zsh.org/mla/workers/2000/msg03993.html
                emulate -L zsh
                local -a cmd; cmd=(${(z)2})
                case $cmd[1] in
                        fg)     if (( $#cmd == 1 )); then
                                        cmd=(builtin jobs -l %+)
                                else
                                        cmd=(builtin jobs -l $cmd[2])
                                fi
                                ;;
                        %*)
                                cmd=(builtin jobs -l $cmd[1])
                                ;;
                        cd)     if (( $#cmd == 2 )); then
                                        cmd[1]=$cmd[2]
                                fi
                                ;&
                        *)
                                echo -n "k$cmd[1]:t\\"
                                return
                                ;;
                esac

                local -A jt; jt=(${(kv)jobtexts})

                $cmd >>(read num rest
                        cmd=(${(z)${(e):-\$jt$num}})
                        echo -n "k$cmd[1]:t\\") 2>/dev/null
        }
        chpwd
fi

function peco-select-history() {
    local tac
    if which tac > /dev/null; then
        tac="tac"
    else
        tac="tail -r"
    fi
    BUFFER=$(history -n 1 | \
        eval $tac | \
        peco --query "$LBUFFER")
    CURSOR=$#BUFFER
    zle clear-screen
}
zle -N peco-select-history

bindkey '^r' peco-select-history

case "${OSTYPE}" in
darwin*)
    alias ls='ls -G'
    eval "$(rbenv init -)"
    export JAVA_HOME=`/usr/libexec/java_home`
    ;;  
linux*)
    alias ls='ls --color=auto'
    export PATH="$HOME/.rbenv/bin:$PATH"
    eval "$(rbenv init -)"
    alias be='bundle exec'
    ;;
esac

